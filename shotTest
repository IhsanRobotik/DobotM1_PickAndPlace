import cv2
import numpy as np
import requests
from ultralytics import YOLO  # Ensure you have the ultralytics library installed
import torch

# Load the YOLO model
model = YOLO("best2.pt")  # Replace with the path to your YOLO model

url = "http://192.168.100.231:8080/shot.jpg"

device = 0 if torch.cuda.is_available() else 'cpu'
cv2.namedWindow("YOLO Webcam Inference", cv2.WINDOW_NORMAL)

while True:
    # Fetch the image from the URL
    img_resp = requests.get(url)
    img_arr = np.array(bytearray(img_resp.content), dtype=np.uint8)
    frame = cv2.imdecode(img_arr, -1)

    # Perform YOLO inference
    results = model(frame)

    # Visualize the results on the frame
    annotated_frame = results[0].plot()

    # Display the annotated frame
    cv2.imshow("YOLO Inference", annotated_frame)
    if cv2.waitKey(1) == ord("q"):
        break

cv2.destroyAllWindows()
